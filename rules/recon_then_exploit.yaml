id: community-recon-then-exploit
name: "Recon Followed by Exploit Attempt"
description: "Detects a reconnaissance phase (port scan or RPC enumeration) followed by an exploit attempt from the same source within 1 hour."
type: sequence
enabled: true
severity: 9
category: "Kill Chain"
tags:
  - kill-chain
  - multi-stage
  - recon
  - exploit
mitre:
  tactic_id: "TA0043"
  tactic_name: "Reconnaissance"
  technique_id: "T1595"
depends_on:
  - builtin-rpc-abuse
  - builtin-unauthorized-access
conditions:
  match:
    - field: action
      operator: prefix
      value: "alert.fired"
sequence:
  ordered: true
  max_span: 1h
  steps:
    - name: recon-phase
      conditions:
        - field: action
          operator: eq
          value: "alert.fired"
        - field: metadata.rule_id
          operator: eq
          value: "builtin-rpc-abuse"
      required: true
    - name: exploit-phase
      conditions:
        - field: action
          operator: eq
          value: "alert.fired"
        - field: metadata.rule_id
          operator: eq
          value: "builtin-unauthorized-access"
      required: true
window: 1h
group_by:
  - actor.ip
